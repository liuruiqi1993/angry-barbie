---
description: '参考：https://juejin.cn/post/6910009240053055496#heading-20'
---

# Vue3

## 底层优化

### Proxy 代理

Vue2 响应式的基本原理，就是通过 `Object.defineProperty`，但这个方式存在缺陷。使得 Vue 不得不通过一些手段来 hack，如：

* Vue.$set\(\) 动态添加新的响应式属性
* 无法监听数组变化，Vue 底层需要对数组的一些操作方法，进行再封装。如 `push`，`pop` 等方法。

而在 Vue3 中优先使用了 Proxy 来处理，它代理的是整个对象而不是对象的属性，可对于整个对象进行操作。不仅提升了性能，也没有上面所说的缺陷。                                                                                                                                                                                                                                                                                                                                  

* `Object.defineProperty`无法监控到数组下标的变化，导致通过数组下标添加元素，不能实时响应；
* `Object.defineProperty`只能劫持对象的属性，从而需要对每个对象，每个属性进行遍历，如果，属性值是对象，还需要深度遍历。Proxy可以劫持整个对象，并返回一个新的对象。
* Proxy不仅可以代理对象，还可以代理数组。还可以代理动态增加的属性。

### 静态提升（hoistStatic） vdom

我们都知道 Vue 有虚拟dom的概念，它能为我们在数据改变时高效的渲染页面。

Vue3 优化了 vdom 的更新性能，静态提升包含「静态节点」和「静态属性」的提升，也就是说，我们把一些静态的不会变的节点用变量缓存起来，提供下次 re-render 直接调用。  
如果没有做这个动作，当 `render` 重新执行时，即使标签是静态的，也会被重新创建，这就会产生性能消耗。

